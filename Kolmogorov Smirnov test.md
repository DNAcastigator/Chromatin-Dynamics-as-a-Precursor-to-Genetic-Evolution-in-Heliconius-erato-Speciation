# k-S test
in this project, I used a basic two-sample K-S test to understand whether the fst values in the unique ATAC-peaks were statistically different than the background fst values in the two genomes of interest.
The empirical unique ATAC-peaks distribution is coming directly from our data.
the background distribution was generated by averaging 1000 random ranked sampling: basically, every random sampling consisted in a number of points equal to the unique ATAC-peaks set; these points were then ranked (from lowest to highest) and saved. after 1000 ranked random sampling wach rank was 
averaged to obtain a theoretical expected value for each rank. The random sampling was always perfomed based on the ATAC seq frequencing position calculated on all the ATAC peaks identified in the two population of interest
```R
freq_fun<-function(dataf,position,dat){
  if(dat=="Fst"){
    freq.df=dataf[,c(2,3,9)]
  }else{
    freq.df=dataf[,c(2,1,3)]
    freq.df$V1=dataf$V2+999
    colnames(freq.df)=c("start","end","Fst")
    
  }
  freq.df$frq=apply(freq.df,1,function(x){
    len=length(position[position>x[1] & position<x[2]])
    #/(x[2]-x[1])
    return(len)  
  })
  return(freq.df)
}
```
The empirical distribution was then compared to the "expected" distribution, here is the full function:
```R
rank_plot<-function(dataf,position,freq.df,num,dat){
  if (dat=="sweep"){
    end=tail(dataf$V2,1)+999
    dataf=dataf[order(dataf$V2),]
    dataf=base::transform(dataf, V5 = c(dataf$V2[-1]-1, end))
    subset=lapply(position,function(x){
      res=dataf$V3[x>dataf$V2 & x<dataf$V5] 
      
      return(res)
      
    })
  }else{
  subset=lapply(position,function(x){
    res=dataf$Fst[x>dataf$start & x<dataf$end] 
    
    return(res)
    
  })
  }
  subset=do.call(rbind.data.frame, subset)
  subset=na.omit(subset)
  colnames(subset)="Fst"
  subset$sigla="test"
  subset=subset[order(subset$Fst),]
  subset$rank=seq(1:nrow(subset))
  
  n=nrow(subset)
  
  
  ############
  freq.df=freq.df[!is.na(freq.df$Fst),]
  total=data.frame(Fst=sample(freq.df$Fst,size=n,prob=freq.df$frq,replace=TRUE),rank=0)
  total=total[order(total$Fst),]
  total$rank=seq(1:nrow(total))
  
  for (i in seq(1:num)){
      single=data.frame(Fst=sample(freq.df$Fst,size=n,prob=freq.df$frq,replace=TRUE),rank=0)
      single=single[order(single$Fst),]
      single$rank=seq(1:nrow(single))
      total=rbind(total,single)
    
  }
  rankandom=data.frame(total %>% group_by(rank) %>% summarise(Fst = mean(Fst)),sigla="random")
  random=rankandom[,c(2,3,1)]
  
  ###############
  final=rbind(subset,random)
  
  
  ranksweep2=subset %>% slice(-seq(1, (n()/10)*9.5))
  
  rankandom2=rankandom %>% slice(-seq(1, (n()/10)*9.5))
  
  print(ks.test(subset$Fst,rankandom$Fst,alternative="less",simulate.p.value =TRUE))
  print(nrow(rankandom))
  print(nrow(subset))
  f=ggplot(rbind(subset,rankandom))+geom_line(aes(x=as.numeric(rank),y=Fst,col=sigla))+geom_point(aes(x=as.numeric(rank),y=Fst,col=sigla))+theme_classic()
  if(dat=="sweep") {f=f+ylab("CLR")}
  oupput=full_join(subset,rankandom,by="rank")
  return(list(f,oupput))
}

```
the full scripti (that also perfoms the [RBb test](https://github.com/DNAcastigator/summer-project/blob/main/RBb%20test.md)) is [here](https://github.com/DNAcastigator/summer-project/blob/main/scripts/correlation_statistic.R)
